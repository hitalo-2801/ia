<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Planilha de Inspe√ß√£o</title>

  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f0f2f5; }
    h2 { color: #1c1e21; text-align: center; }
    
    .controles { margin-bottom: 20px; text-align: center; }
    .btn-acao { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 0 5px; transition: 0.2s; }
    .btn-nova { background-color: #007bff; color: white; }
    .btn-desfazer { background-color: #6c757d; color: white; }
    .btn-acao:hover { opacity: 0.9; transform: translateY(-1px); }

    table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #e0e0e0; padding: 12px; text-align: center; }
    th { background-color: #f8f9fa; color: #4b4f56; text-transform: uppercase; font-size: 12px; }

    input[type="text"] { width: 90%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; outline: none; }
    input[type="text"]:focus { border-color: #007bff; }
    
    /* Ajuste do bot√£o de Status */
    .status { 
      width: 45px; 
      height: 45px; 
      border: none; 
      cursor: pointer; 
      border-radius: 8px; 
      font-size: 20px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      margin: 0 auto;
      transition: background 0.3s;
    }
    .verde { background-color: #28a745; color: white; }
    .vermelho { background-color: #dc3545; color: white; }

    .inspecao { background-color: #e9ecef; border: 1px solid #ced4da; padding: 8px 12px; cursor: pointer; border-radius: 4px; font-size: 13px; }
    .amarelo { background-color: #ffc107; border-color: #ffc107; color: #000; }

    textarea { width: 95%; height: 80px; margin-top: 8px; border: 1px solid #ddd; border-radius: 4px; padding: 8px; display: none; resize: vertical; }

    #container-texto { margin-top: 30px; background: #fff; padding: 20px; border-radius: 8px; border-left: 6px solid #007bff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    #textop { white-space: pre-wrap; line-height: 1.8; font-family: 'Courier New', Courier, monospace; font-size: 15px; color: #333; }
  </style>
</head>

<body>

<h2>üìã Passagem de Servi√ßo</h2>

<div class="controles">
  <button class="btn-acao btn-nova" onclick="novaLinha()">‚ûï Nova Linha</button>
  <button class="btn-acao btn-desfazer" onclick="voltar()">‚Ü©Ô∏è Desfazer</button>
</div>

<table>
  <thead>
    <tr>
      <th style="width: 30%;">Nome</th>
      <th style="width: 50%;">Observa√ß√µes</th>
      <th style="width: 20%;">Status</th>
    </tr>
  </thead>
  <tbody id="tabela"></tbody>
</table>

<section id="container-texto">
  <strong>üìù Resumo Gerado:</strong>
  <p id="textop"></p>
</section>

<script>
  let dados = JSON.parse(localStorage.getItem("planilha")) || [];
  let historico = [];

  const tabela = document.getElementById("tabela");
  const textoSaida = document.getElementById("textop");

  function salvar() {
    localStorage.setItem("planilha", JSON.stringify(dados));
    atualizarTexto();
  }

  function salvarHistorico() {
    historico.push(JSON.stringify(dados));
    if (historico.length > 30) historico.shift();
  }

  function voltar() {
    if (historico.length > 0) {
      dados = JSON.parse(historico.pop());
      salvar();
      renderizar();
    } else {
      alert("Nada para desfazer.");
    }
  }

  function atualizarTexto() {
    if (dados.length === 0) {
      textoSaida.innerHTML = "Aguardando dados...";
      return;
    }

    const formatado = dados.map(item => {
      const emoji = item.status === "verde" ? "‚úÖ" : "‚ùå";
      const nome = item.nome || "Vazio";
      const obs = item.obs ? `: ${item.obs}` : "";
      return `${nome}, ${emoji}${obs};`;
    });

    textoSaida.innerHTML = formatado.join("<br>");
  }

  function renderizar() {
    tabela.innerHTML = "";

    dados.forEach((linha, i) => {
      const tr = document.createElement("tr");

      // NOME
      const tdNome = document.createElement("td");
      const inputNome = document.createElement("input");
      inputNome.type = "text";
      inputNome.placeholder = "Digite o nome...";
      inputNome.value = linha.nome;
      inputNome.onfocus = () => salvarHistorico();
      inputNome.oninput = () => { dados[i].nome = inputNome.value; salvar(); };
      tdNome.appendChild(inputNome);

      // OBSERVA√á√ÉO
      const tdObs = document.createElement("td");
      const btnObs = document.createElement("button");
      btnObs.textContent = linha.obs ? "üìù Editar Obs." : "‚ûï Add Obs.";
      btnObs.className = "inspecao" + (linha.obs ? " amarelo" : "");
      
      const areaTexto = document.createElement("textarea");
      areaTexto.value = linha.obs;
      if (linha.obs) areaTexto.style.display = "block";

      btnObs.onclick = () => {
        const estaAberto = areaTexto.style.display === "block";
        areaTexto.style.display = estaAberto ? "none" : "block";
      };

      areaTexto.onfocus = () => salvarHistorico();
      areaTexto.oninput = () => {
        dados[i].obs = areaTexto.value;
        btnObs.className = "inspecao" + (areaTexto.value.trim() !== "" ? " amarelo" : "");
        btnObs.textContent = areaTexto.value.trim() !== "" ? "üìù Editar Obs." : "‚ûï Add Obs.";
        salvar();
      };
      tdObs.appendChild(btnObs);
      tdObs.appendChild(areaTexto);

      // STATUS (BOT√ÉO COM EMOJI)
      const tdStatus = document.createElement("td");
      const btnStatus = document.createElement("button");
      btnStatus.className = "status " + linha.status;
      // Coloca o emoji dentro do bot√£o para ele ter tamanho
      btnStatus.textContent = linha.status === "verde" ? "‚úÖ" : "‚ùå";
      
      btnStatus.onclick = () => {
        salvarHistorico();
        dados[i].status = linha.status === "verde" ? "vermelho" : "verde";
        salvar();
        renderizar();
      };
      tdStatus.appendChild(btnStatus);

      tr.appendChild(tdNome);
      tr.appendChild(tdObs);
      tr.appendChild(tdStatus);
      tabela.appendChild(tr);
    });
    atualizarTexto();
  }

  function novaLinha() {
    salvarHistorico();
    dados.push({ nome: "", obs: "", status: "verde" });
    salvar();
    renderizar();
  }

  renderizar();
</script>

</body>
</html>